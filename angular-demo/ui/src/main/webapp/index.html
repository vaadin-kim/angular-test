<!DOCTYPE html>
<html ng-app="listApp">
<head>
<title></title>
<script src="https://code.angularjs.org/1.2.9/angular.min.js"></script>
<script src="http://underscorejs.org/underscore-min.js"></script>
<script>
	var listApp = angular.module('listApp', []);
	listApp.controller('listCtrl', function($scope, $http) {

		$http.get('/findAll').success(function(data) {
			$scope.persons = data;
		});

		var selectedPerson = null;

		$scope.addPerson = function() {
			var person = {
				firstName : $scope.firstName,
				lastName : $scope.lastName,
				phone : $scope.phone,
				email : $scope.email
			};

			$http.post('/addPerson', person).success(function(data, status, headers, config) {
				$scope.persons.push(data);
			});
		};
		
		$scope.deleteSelected = function() {
			$http.post('/removePerson', selectedPerson.id).success(function(data, status, headers, config) {
				selectedPerson = null;
				$http.get('/findAll').success(function(data) {
					$scope.persons = data;
				});
			});
		}

		var deselectAll = function() {
			$scope.persons.forEach(function(person) {
				person.selected = false;
			});

			selectedPerson = null;

			$scope.firstName = "";
			$scope.lastName = "";
			$scope.phone = "";
			$scope.email = "";
		}

		$scope.editSelected = function() {
			if (selectedPerson != null) {
				$scope.firstName = selectedPerson.firstName;
				$scope.lastName = selectedPerson.lastName;
				$scope.phone = selectedPerson.phone;
				$scope.email = selectedPerson.email;
			}
		}

		$scope.select = function(personId) {
			var person = _.findWhere($scope.persons, {id: personId});
			var selected = person == selectedPerson && person != null;
			
			deselectAll();

			if (!selected) {
				selectedPerson = person;
			}
		};

		$scope.noPersonIsSelected = function() {
			return selectedPerson == null;
		}
	});
</script>
<style type="text/css">
html,body {
	height: 100%;
	width: 100%;
}

#table {
	width: 100%;
	height: 50%;
}

#form {
	width: 100%;
	height: 50%;
	border-top: solid 1px #000000;
}

#form table {
	width: 100%;
}

#form td input {
	width: 100%;
}

#form td {
	box-sizing: border-box;
	padding: 3px 10px;
}

.even {
	background-color: white;
}

.odd {
	background-color: silver;
}

.selected {
	background-color: grey;
}
</style>
</head>
<body ng-controller="listCtrl">
	<div id="table">
		<table>
			<thead>
				<th>First name</th>
				<th>Last name</th>
				<th>Phone number</th>
				<th>Email address</th>
			</thead>
			<tr ng-repeat="person in persons" ng-class-even="'even'"
				ng-class-odd="'odd'" ng-class="{selected: 'selected'}"
				ng-click="select(person.id)">
				<td>{{person.firstName}}</td>
				<td>{{person.lastName}}</td>
				<td>{{person.phone}}</td>
				<td>{{person.email}}</td>
			</tr>
		</table>
		<div>
			<input type="button" value="Edit" ng-disabled="noPersonIsSelected()" ng-click="editSelected()" /> 
			<input type="button" value="Delete"	ng-disabled="noPersonIsSelected()" ng-click="deleteSelected()" /> 
			<input type="button" value="New" ng-click="addPerson()" />
		</div>
	</div>
	<div id="form">
		<table>
			<tr>
				<td width="30%">First name</td>
				<td width="70%">Last name</td>
			</tr>
			<tr>
				<td><input type="text" ng-model="firstName" /></td>
				<td><input type="text" ng-model="lastName" /></td>
			</tr>
			<tr>
				<td>Phone number</td>
				<td>Email address</td>
			</tr>
			<tr>
				<td><input type="text" ng-model="phone" /></td>
				<td><input type="text" ng-model="email" /></td>
			</tr>
		</table>
		<div>
			<input type="button" value="Save" /> <input type="button"
				value="Cancel" />
		</div>
	</div>
</body>
</html>

